---
layout: post
title: 利用浏览器缓存
date: 2019.7.8
---

> 目标：充分利用浏览器的缓存能力。

- 源码没有变化的部分，打包生成的文件名称不应该变化。
- 源码发生修改的部分，打包生成的文件名称应该变化，避免浏览器加载旧的缓存代码。
  - 修改部分影响打包的范围应该尽量小，尽量不要牵连未被修改的代码、导致其也被打包出新的文件。

> 打包策略

- 将 webpack 打包生成的运行时代码拆分到单独的 chunk,避免 webpack 运行时代码的影响
  ```javascript
  return {
    optimization: {
      runtimeChunk: true,
    },
  };
  ```
- 单独抽取第三方依赖的包
  - 第三方包通常比较稳定，只有在大的版本升级时才发生修改。
  - 应该从业务代码中分离，避免业务修改的影响。
- 打包后的文件名称中，\[hash\]值尽量少范围的更改。
  - 文件命名方式
    - \[hash\]: 不推荐
      - 所有文件对应同一个 hash
      - 打包涉及的任意源码文件发生更改，hash 均发生更改
    - \[chunkhash\]: 中等推荐
      - 每一个 chunk 对应一个 hash, 可能包含多个源码文件(js/css/json...), 打包后可能生成多个文件
      - 同一 chunk 涉及的任意源码文件发生更改，打包后 chunk 下各文件 hash 均发生更改
    - \[contenthash\]: 最佳实践
      - 根据各自文件打包后的内容生成 hash
      - 源码修改后，打包生成文件的 hash 变动最小化
  - module.id hashed
    - 默认情况下，webpack 在打包过程中，按模块依赖树为各模块分配一个数字 id
    - 树的某个层级节点发生变化，导致后续多个节点变化，影响相应打包文件
    - 将模块标识 hash 化，会将模块打包结果更为稳定可控

> [返回]({{site.baseurl}}/webpack总结)
